# PR#6.1: Destructive Trim - Quick Start

---

## TL;DR (30 seconds)

**What:** Refactor trim system to permanently trim clips (iMovie-style). Trimming deletes excess footage immediately, not just on export.

**Why:** Users expect "trim" to delete parts. Current system is confusing (video still shows full length).

**Time:** 4-6 hours estimated

**Complexity:** MEDIUM-HIGH

**Status:** üìã READY TO START

---

## Decision Framework (2 minutes)

### Should You Build This Feature?

**Green Lights (Build it!):**
- ‚úÖ PR #6 complete with current trim system
- ‚úÖ You have 4-6 hours available
- ‚úÖ Want iMovie-style intuitive trimming
- ‚úÖ Users are confused by current non-destructive approach
- ‚úÖ You want "what you see is what you get" editing

**Red Lights (Skip it!):**
- ‚ùå Current trim system not complete
- ‚ùå Less than 3 hours available
- ‚ùå Current system is "good enough" for MVP
- ‚ùå Users understand non-destructive marks

**Decision Aid:** If users keep asking "where did my trim go?" then build this. If users are happy with current system, skip it.

---

## Prerequisites (5 minutes)

### Required
- [ ] PR #6 (current trim) complete
- [ ] Trim handles working
- [ ] Export working
- [ ] Understanding of current state structure

### Setup Commands
```bash
# 1. Ensure PR #6 is complete
git status

# 2. Create feature branch
git checkout feature/pr06.1-destructive-trim

# 3. Review current trim implementation
grep -r "clipTrims" src/
```

---

## Getting Started (First Hour)

### Step 1: Understand the Change (30 minutes)
- [ ] Read `PR06.1_DESTRUCTIVE_TRIM.md` specification
- [ ] Understand: trim marks ‚Üí render ‚Üí replace clip
- [ ] Review state transition diagram
- [ ] Compare with current system

### Step 2: Review Current System (20 minutes)
- [ ] Check how clipTrims currently works
- [ ] Check how export uses trim marks
- [ ] Check player trim boundaries
- [ ] Note what needs to change

### Step 3: Plan Implementation (10 minutes)
- [ ] Review implementation checklist
- [ ] Identify starting point (Phase 1)
- [ ] Note dependencies between phases
- [ ] Prepare for render function

---

## Daily Progress Template

### Hour 1-2: UI & Rendering Setup (2 hours)

**Apply Button (30 min)**
- [ ] Add "Apply Trim" button
- [ ] Add disabled states
- [ ] Wire up to handler

**Render Function (90 min)**
- [ ] Create renderTrimmedClip()
- [ ] Add IPC handler
- [ ] Test rendering works

**Checkpoint:** Can render trimmed clip to temp file ‚úì

---

### Hour 3-4: State Updates & Player (2 hours)

**State Management (60 min)**
- [ ] Implement handleApplyTrim()
- [ ] Update clip state after render
- [ ] Clear trim marks
- [ ] Handle errors

**Player Integration (60 min)**
- [ ] Use trimmed path in player
- [ ] Remove trim boundaries
- [ ] Update duration display
- [ ] Test playback

**Checkpoint:** Trimmed clip replaces original in timeline ‚úì

---

### Hour 5-6: Timeline & Export (2 hours)

**Timeline Cleanup (30 min)**
- [ ] Remove trim overlays
- [ ] Update width calculation
- [ ] Show actual durations

**Export Simplification (30 min)**
- [ ] Remove trim logic from export
- [ ] Use current clip path directly
- [ ] Test export works

**Testing (60 min)**
- [ ] Test complete workflow
- [ ] Test multiple clips
- [ ] Test render progress
- [ ] Fix any bugs

**Checkpoint:** Complete destructive trim working ‚úì

---

## Common Issues & Solutions

### Issue 1: Render Too Slow
**Symptoms:** Takes 30+ seconds to render  
**Cause:** Preset is too high quality  
**Solution:** Use `ultrafast` preset for MVP:
```javascript
.outputOptions(['-preset ultrafast', '-crf 23'])
```

### Issue 2: Temp Files Piling Up
**Symptoms:** Disk space filling up  
**Cause:** Temp files not cleaned up  
**Solution:** Clean up on app exit:
```javascript
app.on('before-quit', () => {
  // Clean temp directory
});
```

### Issue 3: State Update Race Condition
**Symptoms:** Clip state inconsistent after apply  
**Cause:** State update before render completes  
**Solution:** Wait for render before updating:
```javascript
await renderComplete();
setClips(updatedClips); // Update after
```

### Issue 4: Player Shows Wrong Duration
**Symptoms:** Player shows original duration  
**Cause:** Player using original path  
**Solution:** Use trimmedPath when available:
```javascript
const videoSrc = clip.trimmedPath || clip.path;
```

### Issue 5: Export Still Shows Trim
**Symptoms:** Export seems longer than trimmed  
**Cause:** Export still using trim marks  
**Solution:** Check export uses current clip path:
```javascript
// Should be just the path, no trim data
export(clip.path, outputPath, {}); // No trim
```

---

## Quick Reference

### Key Files
- `src/components/TrimControls.js` - Add Apply button
- `electron/ffmpeg/videoProcessing.js` - Render function (+80 lines)
- `src/App.js` - State management (+60 lines)
- `src/components/VideoPlayer.js` - Use trimmed path (+20 lines)
- `src/components/Timeline.js` - Remove overlays (-40 lines)
- `src/components/ExportPanel.js` - Simplify export (-10 lines)
- `main.js` - IPC handler (+30 lines)
- `preload.js` - API exposure (+5 lines)

### Key Functions
- `renderTrimmedClip()` - FFmpeg rendering
- `handleApplyTrim()` - State update
- `window.electronAPI.renderTrimmedClip()` - IPC call

### State Changes
```javascript
// Before
clips = [{ id, path, duration: 120 }]
clipTrims = { 'clip-1': { inPoint: 10, outPoint: 40 } }

// After
clips = [{
  id,
  path: '/original.mp4',
  trimmedPath: '/temp/trimmed.mp4', // ‚Üê NEW
  duration: 30,  // ‚Üê Updated
  isTrimmed: true,
  trimStartOffset: 10
}]
clipTrims = {} // ‚Üê Cleared after apply
```

---

## Success Metrics

**You'll know it's working when:**
- [ ] Click "Apply Trim" ‚Üí clip renders
- [ ] Timeline shows shorter clip
- [ ] Player shows 0:00 to 30s (trimmed)
- [ ] Export produces 30s video
- [ ] No draft trim marks visible
- [ ] Switching clips preserves trimmed state

---

## Testing Script

### Complete Workflow Test
```
1. Import clip (e.g., 120s video)
   Expected: Timeline shows 120s ‚úì

2. Drag IN to 10s, OUT to 40s
   Expected: Slider shows 10s-40s, Duration: 30s ‚úì

3. Click "Apply Trim"
   Expected: "Rendering..." message appears ‚úì
   Expected: Progress bar fills ‚úì
   Expected: "Done!" message appears ‚úì

4. Check timeline
   Expected: Shows 30s clip (not 120s) ‚úì

5. Play video
   Expected: Shows 0:00 to 0:30 ‚úì
   Expected: Video is shortened content ‚úì

6. Export
   Expected: Exported video is 30s ‚úì
   Expected: Matches trimmed content ‚úì

7. Import another clip
   Expected: Can trim it independently ‚úì

8. Switch back to first clip
   Expected: Still shows 30s (trim preserved) ‚úì
```

---

**Status:** Ready to implement! üöÄ

**Remember:** This is a major refactor. Take it step-by-step and test after each phase!

