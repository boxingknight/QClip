# PR#6.1: Destructive Trim - Implementation Checklist

**Use this as your daily todo list.** Check off items as you complete them.

**Estimated Time:** 4-6 hours  
**Complexity:** MEDIUM-HIGH  
**Current Phase:** ðŸ“‹ Ready to Start

---

## Pre-Implementation Setup (15 minutes)

- [ ] Read main specification (`PR06.1_DESTRUCTIVE_TRIM.md`) (~30 min)
- [ ] Understand current trim system (PR#6)
- [ ] Review state management in App.js
- [ ] Review FFmpeg rendering in videoProcessing.js
- [ ] Git branch created:
```bash
git checkout feature/pr06-1-destructive-trim
```

---

## Phase 1: Add Apply Button UI (30 minutes)

### Step 1.1: Modify TrimControls Component (20 minutes)

#### Update Button Logic
- [ ] Add "Apply Trim" button to component
- [ ] Position below slider
- [ ] Style as prominent primary button

#### Add Disabled States
- [ ] Disable if no trim marks set
- [ ] Disable if inPoint >= outPoint
- [ ] Disable if currently rendering

#### Visual Feedback
- [ ] Show "Trimming..." when in progress
- [ ] Show progress percentage
- [ ] Update button text based on state

**Checkpoint:** Apply button visible and functional âœ“

**Commit:** `feat(trim): add Apply Trim button to TrimControls`

---

### Step 1.2: Wire Up Handler (10 minutes)

#### Add Handler in App.js
- [ ] Create `handleApplyTrim()` function stub
- [ ] Pass handler to TrimControls
- [ ] Add isRendering state
- [ ] Add renderProgress state

**Checkpoint:** Handler connected âœ“

**Commit:** `feat(trim): wire up Apply Trim handler`

---

## Phase 2: Rendering Functionality (2 hours)

### Step 2.1: Create Render Function (1 hour)

#### Create Function in videoProcessing.js
- [ ] Add `renderTrimmedClip()` function
- [ ] Accept inputPath, outputPath, trimData, onProgress
- [ ] Use FFmpeg setStartTime() and setDuration()
- [ ] Add progress reporting
- [ ] Handle temp directory creation

#### Test Rendering
- [ ] Call function manually with test data
- [ ] Verify trimmed file is created
- [ ] Verify file plays correctly
- [ ] Check file duration matches

**Checkpoint:** Render function works correctly âœ“

**Commit:** `feat(render): implement trimmed clip rendering`

---

### Step 2.2: IPC Integration (1 hour)

#### Add IPC Handler
- [ ] Update main.js with render handler
- [ ] Update preload.js to expose API
- [ ] Add render progress updates
- [ ] Handle IPC errors

#### Update App.js Integration
- [ ] Call render API from handler
- [ ] Show progress during render
- [ ] Handle render completion
- [ ] Handle render errors

**Checkpoint:** IPC communication working âœ“

**Commit:** `feat(render): integrate IPC for trim rendering`

---

## Phase 3: State Update Logic (1 hour)

### Step 3.1: Update Clip State (40 minutes)

#### Implement State Update
- [ ] Update clip.duration to trimmed length
- [ ] Add clip.trimmedPath
- [ ] Add clip.isTrimmed flag
- [ ] Preserve clip.trimStartOffset for undo

#### Update Selected Clip
- [ ] Sync selected clip state
- [ ] Update duration display
- [ ] Update timeline widths
- [ ] Refresh player

**Checkpoint:** Clip state updates correctly âœ“

**Commit:** `feat(trim): update clip state after rendering`

---

### Step 3.2: Clear Trim Marks (20 minutes)

#### Remove Draft Marks
- [ ] Clear trim marks from clipTrims object
- [ ] Reset slider to full length
- [ ] Update UI to show applied state
- [ ] Disable slider (trim already applied)

**Checkpoint:** Trim marks cleared after apply âœ“

**Commit:** `feat(trim): clear draft marks after applying`

---

## Phase 4: Player Integration (30 minutes)

### Step 4.1: Use Trimmed Path (15 minutes)

#### Update VideoPlayer
- [ ] Accept trimmedPath prop
- [ ] Use trimmedPath when available
- [ ] Fall back to original path
- [ ] Remove trim boundary checks (not needed)

**Checkpoint:** Player uses trimmed clip âœ“

**Commit:** `feat(player): use trimmed clip path`

---

### Step 4.2: Update Duration Display (15 minutes)

#### Show Actual Duration
- [ ] Display trimmed duration (not original)
- [ ] Update time display logic
- [ ] Player shows 0:00 to new duration
- [ ] Remove trim indicator (clip is already trimmed)

**Checkpoint:** Duration displays correctly âœ“

**Commit:** `feat(player): show trimmed duration`

---

## Phase 5: Timeline Cleanup (30 minutes)

### Step 5.1: Remove Trim Overlays (15 minutes)

#### Remove Visual Indicators
- [ ] Remove trim-darken overlays
- [ ] Remove trim-highlighted overlays
- [ ] Timeline shows actual clip only
- [ ] Width based on actual duration

**Checkpoint:** Timeline shows final clips âœ“

**Commit:** `feat(timeline): remove trim overlays for applied trims`

---

### Step 5.2: Update Duration Calculation (15 minutes)

#### Fix Width Calculation
- [ ] Use clip.duration (already trimmed)
- [ ] Sum actual durations, not original
- [ ] Update timeline header total
- [ ] Test with multiple trimmed clips

**Checkpoint:** Timeline widths correct âœ“

**Commit:** `feat(timeline): calculate widths from actual durations`

---

## Phase 6: Export Simplification (30 minutes)

### Step 6.1: Remove Trim Logic (15 minutes)

#### Simplify Export Flow
- [ ] Remove trim data from export
- [ ] Use clip.path directly
- [ ] No need for FFmpeg trim (already trimmed)
- [ ] Update export handler

**Checkpoint:** Export simplified âœ“

**Commit:** `feat(export): simplify export for trimmed clips`

---

### Step 6.2: Multi-Clip Export (15 minutes)

#### Export All Clips
- [ ] Iterate through all clips
- [ ] Export each using its current path
- [ ] TODO: Implement concatenation
- [ ] For now, export individually

**Checkpoint:** Multi-clip export works âœ“

**Commit:** `feat(export): export all trimmed clips`

---

## Phase 7: Testing & Polish (1 hour)

### Step 7.1: Render Progress Display (20 minutes)

#### Add Progress UI
- [ ] Show progress bar during render
- [ ] Update progress percentage
- [ ] Show "Rendering..." message
- [ ] Disable interactions during render

**Checkpoint:** Progress display working âœ“

**Commit:** `feat(trim): add render progress feedback`

---

### Step 7.2: Error Handling (20 minutes)

#### Handle Render Errors
- [ ] Catch render failures
- [ ] Show error message
- [ ] Allow retry
- [ ] Clean up on error

**Checkpoint:** Errors handled gracefully âœ“

**Commit:** `feat(trim): add error handling for render`

---

### Step 7.3: Testing Workflow (20 minutes)

#### Test Complete Flow
- [ ] Import clip
- [ ] Set trim marks
- [ ] Click Apply
- [ ] Verify render completes
- [ ] Verify timeline updates
- [ ] Verify player shows trimmed clip
- [ ] Verify export works
- [ ] Test with multiple clips

**Checkpoint:** Full workflow tested âœ“

**Commit:** `test(trim): verify complete destructive trim workflow`

---

## Completion Checklist

- [ ] All Phase 1 tasks complete
- [ ] All Phase 2 tasks complete
- [ ] All Phase 3 tasks complete
- [ ] All Phase 4 tasks complete
- [ ] All Phase 5 tasks complete
- [ ] All Phase 6 tasks complete
- [ ] All Phase 7 tasks complete
- [ ] Render completes successfully
- [ ] Timeline shows trimmed clips
- [ ] Player shows trimmed clips
- [ ] Export produces correct videos
- [ ] No memory leaks
- [ ] Temp files cleaned up

**Final Commit:** `feat(trim): complete destructive trim implementation`

---

## Time Tracking

**Estimated Total:** 4-6 hours  
**Actual Total:** ___ hours

| Phase | Estimated | Actual |
|-------|-----------|--------|
| Phase 1 | 30 min | ___ min |
| Phase 2 | 2 hours | ___ min |
| Phase 3 | 1 hour | ___ min |
| Phase 4 | 30 min | ___ min |
| Phase 5 | 30 min | ___ min |
| Phase 6 | 30 min | ___ min |
| Phase 7 | 1 hour | ___ min |
| Buffer | 1 hour | ___ min |

