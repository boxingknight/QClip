# PR#6.1: Destructive Trim - Testing Guide

**Purpose:** Comprehensive testing strategy for destructive trim refactor  
**Estimated Testing Time:** 1.5 hours  
**Test Categories:** Unit, Integration, Edge Cases, Performance

---

## Test Categories

### 1. Apply Trim Button (30 minutes)

**Test: Button State Management**

Test: Button disabled when no trim marks set
- Action: Load clip without setting trim
- Expected: "Apply Trim" button disabled
- UI: Button shows "Set trim first" or similar

Test: Button enabled when valid trim set
- Action: Set IN at 10s, OUT at 40s
- Expected: "Apply Trim" button enabled
- UI: Button clickable, shows "Apply Trim"

Test: Button disabled during rendering
- Action: Click Apply button
- Expected: Button immediately disabled
- UI: Shows "Trimming..." with spinner
- Progress: Progress bar appears

Test: Button re-enabled after render complete
- Action: Wait for render to complete
- Expected: Button re-enabled (for next clip)
- UI: Returns to ready state

---

### 2. Rendering Functionality (30 minutes)

**Test: Render Creates Trimmed File**

Test: Render with valid trim
- Input: Clip at /path/video.mp4, trim 10-40s
- Action: Call renderTrimmedClip()
- Expected: Creates /temp/clip-trimmed.mp4
- File: File exists and is readable
- Duration: File duration is 30 seconds

Test: Render with start trim only
- Input: Trim 10-duration (trimmed end)
- Action: Call renderTrimmedClip()
- Expected: Creates trimmed file
- Duration: File is (duration - 10) seconds

Test: Render with end trim only
- Input: Trim 0-40s (trimmed start)
- Action: Call renderTrimmedClip()
- Expected: Creates trimmed file
- Duration: File is 40 seconds

Test: Render output plays correctly
- Action: Open trimmed file in VLC
- Expected: Plays trimmed segment only
- Content: Should match trimmed portion

Test: Render progress updates
- Action: Monitor progress events
- Expected: Progress goes 0% → 100%
- Updates: Progress updates smoothly
- Completion: "Render complete" message

---

### 3. State Management (20 minutes)

**Test: Clip State Updates**

Test: Original clip preserved
- Before: clip.duration = 120, clip.path = '/original.mp4'
- Action: Apply trim 10-40s
- After: clip.duration = 30, clip.trimmedPath = '/temp/trimmed.mp4'
- Verify: clip.originalDuration = 120 (for undo)

Test: Selected clip updates
- Action: Apply trim on selected clip
- Expected: selectedClip.state updates
- Duration: selectedClip.duration = 30
- Path: Uses trimmed path for playback

Test: Trim marks cleared
- Before: clipTrims['clip-1'] = { inPoint: 10, outPoint: 40 }
- Action: Apply trim
- After: clipTrims['clip-1'] = undefined
- Verify: No draft marks visible

Test: Multiple clips independent
- Action: Import 2 clips, trim clip 1
- Expected: Clip 1 shows 30s, Clip 2 shows full duration
- Switch: Clips maintain their own states

---

### 4. Player Integration (15 minutes)

**Test: Player Shows Trimmed Clip**

Test: Player uses trimmed path
- Action: After applying trim
- Expected: Player uses clip.trimmedPath
- Verify: console.log shows trimmed path

Test: Player shows correct duration
- Action: Load trimmed 30s clip
- Expected: Player shows "0:00 / 0:30"
- Playback: Plays from 0:00 to 0:30 (trimmed segment)

Test: Player starts at beginning
- Action: Play trimmed clip
- Expected: Starts at 0:00 (not 10s offset)
- Behavior: Plays trimmed segment naturally

Test: Player doesn't need trim boundaries
- Action: Try to play past end
- Expected: Pauses at end naturally
- Behavior: No special boundary checks needed

---

### 5. Timeline Updates (15 minutes)

**Test: Timeline Reflects Trim**

Test: Timeline width updates
- Before: 120s clip shows as full width
- Action: Apply trim to 30s
- After: Timeline shows 30s width
- Proportion: Width is 25% of original

Test: Timeline shows actual duration
- Action: Trim two clips to different lengths
- Expected: Width proportional to actual duration
- Header: Total duration shows sum of actual durations

Test: Trim overlays removed
- Before: Shows trim-darken overlays
- After: No overlays (clip is already trimmed)
- Clean: Timeline shows only final clip

Test: Multiple trimmed clips
- Action: Trim clip 1 (30s), clip 2 (60s)
- Expected: Timeline shows both with correct widths
- Proportion: Widths reflect their actual durations

---

### 6. Export Simplification (15 minutes)

**Test: Export Works Without Trim Data**

Test: Export uses trimmed path
- Action: Export after applying trim
- Expected: Export uses clip.trimmedPath
- No Trim: No trim data passed to FFmpeg
- Output: Exported file is 30s

Test: Export is faster (no re-render)
- Action: Compare export times
- Before: Export with trim = render + export time
- After: Export = just copy/re-encode time
- Expected: Export is significantly faster

Test: Export produces correct file
- Action: Export trimmed clip
- Expected: File duration is trimmed length
- Content: Matches trimmed segment
- Plays: File plays correctly

---

## Edge Case Tests

### Edge Case 1: Trim to Zero Duration
**Action:** Set IN and OUT to same value  
**Expected:** Error message, button disabled  
**Prevention:** Validate trim duration > 0.1s

### Edge Case 2: Trim Entire Clip
**Action:** Set IN=0, OUT=duration  
**Expected:** No change (no need to trim)  
**Behavior:** Skip render, just clear marks

### Edge Case 3: Render Failure
**Action:** Simulate FFmpeg error  
**Expected:** Error message, clip unchanged  
**Recovery:** Show retry option, state unchanged

### Edge Case 4: Temp Directory Full
**Action:** Render with disk full  
**Expected:** Error message, cleanup attempted  
**Recovery:** User can retry after freeing space

### Edge Case 5: Multiple Rapid Trims
**Action:** Click Apply rapidly on same clip  
**Expected:** Queues renders, processes sequentially  
**Behavior:** UI shows latest state only

### Edge Case 6: Switching During Render
**Action:** Switch to another clip while rendering  
**Expected:** Render continues in background  
**Recovery:** Shows "Trimming..." on original clip

---

## Performance Tests

### Test 1: Render Speed
- Input: 120s video, trim to 30s
- Target: < 10 seconds render time
- Preset: ultrafast
- Actual: ___ seconds

### Test 2: Render Quality
- Action: Render trimmed clip
- Compare: Trimmed output vs. original quality
- Expected: Visually identical
- Size: File size ~ proportional to duration

### Test 3: State Update Speed
- Action: Apply trim
- Target: State update < 100ms
- Actual: ___ ms
- Behavior: No UI freeze

### Test 4: Memory Usage
- Action: Apply trim multiple times
- Monitor: Memory usage
- Expected: No memory leaks
- Cleanup: Temp files cleaned up

---

## Acceptance Criteria

**Feature is complete when:**
- [ ] Apply button renders trimmed clip
- [ ] Timeline shows shorter clip after apply
- [ ] Player shows trimmed duration (0 to new duration)
- [ ] Player uses trimmed file path
- [ ] Export produces trimmed video
- [ ] Render progress shows during processing
- [ ] Trim marks cleared after apply
- [ ] Multiple clips can be trimmed independently
- [ ] Render completes in < 10 seconds
- [ ] No console errors

**Quality Gates:**
- Zero state inconsistencies
- Trimmed file plays correctly
- Timeline reflects actual durations
- Export matches preview
- Temp files cleaned up

---

## Regression Tests

### Test: Backwards Compatibility
- Action: Import old project with trim marks
- Expected: Still works (uses non-destructive mode)
- Behavior: Marks applied on export only

### Test: Export Still Works
- Action: Export before applying trim
- Expected: Uses trim marks (old behavior)
- Export: Applies trim on export

### Test: Player Fallback
- Action: Load clip without trimmed path
- Expected: Uses original path
- Behavior: Works as before

---

## Manual Testing Checklist

### Setup
- [ ] App launched
- [ ] Import test video (120s clip)
- [ ] Player shows full video
- [ ] Timeline shows 120s width

### Trim Workflow
- [ ] Set IN to 10s
- [ ] Set OUT to 40s
- [ ] Slider shows 10-40s
- [ ] Duration shows "00:30"
- [ ] Apply button enabled
- [ ] Click "Apply Trim"
- [ ] Progress bar appears
- [ ] "Rendering..." message shows
- [ ] Progress updates 0-100%
- [ ] "Done!" message appears

### Verify Trim Applied
- [ ] Timeline now shows 30s width
- [ ] Player duration shows "0:00 / 0:30"
- [ ] Play button works
- [ ] Video plays trimmed segment
- [ ] Video is actually 30s content

### Export Test
- [ ] Click "Export"
- [ ] Save file
- [ ] Export completes
- [ ] Open exported file
- [ ] File is 30s duration
- [ ] Content matches trimmed segment

### Multi-Clip Test
- [ ] Import second clip (100s)
- [ ] First clip still shows 30s ✓
- [ ] Trim second clip to 60s
- [ ] Apply trim
- [ ] Second clip now shows 60s ✓
- [ ] Timeline shows both with correct widths

### Error Handling
- [ ] Attempt trim with IN >= OUT
- [ ] Error message shown
- [ ] Button remains disabled
- [ ] State unchanged

---

**Document Status:** Testing Guide Complete  
**Next Action:** Execute tests during implementation Phase 7

